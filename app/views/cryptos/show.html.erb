<%= javascript_include_tag 'chart' %>
<%= javascript_include_tag 'post' %>
<%= javascript_include_tag 'load' %>
<%= javascript_include_tag 'timechoice' %>
<%= javascript_include_tag 'https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js', defer: true %>
<%= javascript_include_tag 'favorites' %>
<%= javascript_include_tag 'priceAlert' %>
<%= javascript_include_tag 'comment' %>

<%= render 'shared/navbar' %>
<%= render 'shared/flash' %>

<div class="body-flex-show">

  <div class="chart-section">
    <%= button_to root_path, method: :get, class: 'btn-home-go act' do %>
      <%= image_tag 'arrowleft.png', alt: 'arrow-left', class: 'icone' %>
      Back to Home
    <% end %>

    <div class="card-chart">
      <div class="header-card">
        <div class="info-card">
          <%= image_tag(@crypto.logo_url, alt: 'crypto-logo', class: 'crypto-logo') %>
          <div class="name-symbol">
            <span class="price-card">
              $<%= @crypto.price.round(2) %>
              <% variation = @crypto.variation_24h %>
              <% if variation >= 0 %>
                <span class="positif">+<%= number_to_human(variation) %>%</span>
              <% else %>
                <span class="negatif"><%= number_to_human(variation) %>%</span>
              <% end %>
            </span>
            <span class="symbol" id="crypto-symbol"><%= @crypto.symbol %></span>
          </div>
        </div>

        <div class="btn-card">
          <div role="button" id="btn-1m" class="choice">
            <p>1m</p>
          </div>
          <div role="button" id="btn-15m" class="choice">
            <p>15m</p>
          </div>
          <div role="button" id="btn-1h" class="choice">
            <p>1h</p>
          </div>
          <div role="button" id="btn-4h" class="choice">
            <p>4h</p>
          </div>
          <div role="button" id="btn-1d-main" class="choice">
            <p id="time-label">1d</p>
            <%= image_tag "arrowbottom.png", alt: "arrow", class: "arrow-bottom" %>
            <div id="time-options">
              <button id="btn-6h">
                <span>6h</span>
              </button>
              <button id="btn-12h">
                <span>12h</span>
              </button>
              <button id="btn-1d">
                <span>1d</span>
              </button>
            </div>
          </div>
        </div>

        <div class="container-favorites-alert">
          <% if user_signed_in? %>
            <% if @favorite.is_favorite %>
              <%= image_tag "favorites-true.png", alt: "In Favorites", class: "favorites-img", id: "open-favorite-popup" %>
            <% else %>
              <%= image_tag "favorites-false.png", alt: "Add to Favorites", class: "favorites-img", id: "open-favorite-popup" %>
            <% end %>
          <% end %>

          <% if user_signed_in? %>
            <% if @alert_price.id %>
              <%= image_tag "alert-red.png", alt: "In Favorites", class: "alert-img", id: "open-price-alert-popup" %>
            <% else %>
              <%= image_tag "alert.png", alt: "In Favorites", class: "alert-img", id: "open-price-alert-popup" %>
            <% end %>
          <% end %>
        </div>
      </div>

      <div id="chart"></div>
      <div class="info-crypto">
        <div class="container-volume">
          <p class="info-text">Volumes (24h):</p>
          <p class="text-info-card">$<%= @crypto.volume_24h %></p>
        </div>
        <div class="container-price">
          <p class="info-text">Price:</p>
          <p>
            <span class="text-info-card"> $<%= @crypto.price.round(2) %></span>
            <% variation = @crypto.variation_24h.round(2) %>
            <% if variation >= 0 %>
              <span class="positif">+<%= number_to_human(variation) %>%</span>
            <% else %>
              <span class="negatif"><%= number_to_human(variation) %>%</span>
            <% end %>
          </p>
        </div>
      </div>
    </div>

  </div>

  <div class="post-section">
    <%= render 'shared/flash' %>

    <div id="posts_container">
      <% @posts.each do |post| %>
        <div id="post_<%= post.id %>" class="post">
          <div class="post-line">
            <div class="header-post">
              <div class="user-post">
                <%= image_tag "memoji.png", alt: "user", class: "user-icone" %>
                <p class="username-post"><%= post.user.username %></p>
                <% if post.user == current_user %>
                  <%= button_to post_path(post), method: :delete, class: 'btn-delete-comment', data: { confirm: "Are you sure you want to delete this post?" } do %>
                    <%= image_tag 'delete.png', alt: 'Delete', class: 'delete-icone' %>
                  <% end %>
                <% end %>
              </div>
              <p class="time-post">
                <%= image_tag "time.png", alt: "time", class: "time-icone" %>
                <%= time_ago_in_words(post.created_at) %> ago
              </p>
            </div>
            <div class="content-post-container">
              <p class="content-post"><%= post.content %></p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

</div>
